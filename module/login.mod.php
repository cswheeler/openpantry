<?php	/*	login.mod.php		@richard pianka				http://localhost/pantry/login/module_command/		contains the login logic	*/		global $render;	global $module_commands;	$module_commands = array('signin', 'signout');		$parameters = array('module_command');	expand_get($parameters);		$login_framework = new Template();	$login_framework->load('login_framework');	$login_framework_render['message'] = '';	$login_framework_render['content'] = '';		/* ====================================	   === All of the display functions ===	   ==================================== */		function render_all() {		// last thing to execute in this module		global $login_framework_render;		global $login_framework;		global $render;				$login_framework->set_vars($login_framework_render);		$login_framework->parse();		$render['tier_2'] = $login_framework->final;	}		function render_login() {		global $login_framework_render;		global $parameters;		foreach ($parameters as $parameter)			global $$parameter;		$content = "";				$login_login = new Template();		$login_login->load('login_login');		$login_login_render['title'] = '';		$login_login->set_vars($login_login_render);		$login_login->parse();		$content = $login_login->final;				$login_framework_render['content'] = $content;				render_all();	}		/* ===============================	   === Start Building the page ===	   =============================== */		if (!isset($module_command)) {		// display main blog page		render_login();		return;	}		// module logic	if (in_array($module_command, $module_commands)) {		switch ($module_command) {			case 'signin':				$username = post('username');				$password = post('password');				$message = '';								$user_entry = get_user_by_username($username);				$checksum = md5(md5($password) . $user_entry['salt']);				if ($checksum == $user_entry['password']) {					// pass					$message = 'Login succeeded!';					set_session('user', serialize($user_entry));					redirect('/pantry/home');				} else {					// fail					$message = 'Login failed!';				}				$login_framework_render['message'] = $message;								render_login();				break;			case 'signout':				set_session('user', '');				redirect('/pantry/login');				break;			default:				$login_framework_render['message'] = 'An error occurred.';				render_login();		}		render_all();		return;	}	?>